<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê´€ë¦¬ì ë©”ì¸</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
      /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
      body {
        font-family: 'Arial', sans-serif;
        background-color: #f4f7fc;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      /* ì œëª© ìŠ¤íƒ€ì¼ */
      h1 {
        text-align: center;
        font-size: 36px;
        color: #2e3a47;
        margin-top: 40px;
      }
      /* íƒ­ ìŠ¤íƒ€ì¼ */
      .tabs {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }
      .tab,
      .sub-tab {
        padding: 12px 24px;
        border: 1px solid #5b5b5b;
        cursor: pointer;
        background-color: #f4f4f4;
        margin-right: 8px;
        border-radius: 8px;
        transition: background-color 0.3s, color 0.3s;
        user-select: none;
      }
      .tab.active,
      .sub-tab.active {
        background-color: #2e3a47;
        color: white;
        font-weight: bold;
      }
      /* íƒ­ ë‚´ìš© */
      .tab-content {
        display: none;
        padding: 20px;
        width: 100%;
        max-width: 900px;
        border-radius: 8px;
        background-color: #fafafa;
      }
      .tab-content.active {
        display: block;
      }
      /* í‘œ ìŠ¤íƒ€ì¼ */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: left;
      }
      th {
        background-color: #e0e0e0;
        color: #333;
      }
      tr:nth-child(even) {
        background-color: #fafafa;
      }
      /* ì„œë¸Œ íƒ­ ìŠ¤íƒ€ì¼ */
      .sub-tab {
        margin: 0 5px 15px 5px;
        background-color: #f0f0f0;
        border: none;
        border-radius: 8px;
      }
      .sub-tab-content {
        display: none;
      }
      .sub-tab-content.active {
        display: block;
      }
      /* QR ì½”ë“œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
      #qr-result {
        margin-top: 10px;
        font-weight: bold;
      }
      #qr-image {
        margin-top: 20px;
      }
      #back-btn {
        margin-bottom: 15px;
        padding: 6px 12px;
        cursor: pointer;
        background-color: #2e3a47;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h1>V ì•„íŒŒíŠ¸</h1>
    <div class="tabs">
      <div class="tab active" id="tab-entry" onclick="showTab('entry')">
        ì¶œì…ê¸°ë¡
      </div>
      <div class="tab" id="tab-manage" onclick="showTab('manage')">
        ë“±ë¡ ê´€ë¦¬
      </div>
      <button class="sub-tab" id="qrBtn" onclick="showTab('qr')">
        QRì½”ë“œ ë°œê¸‰
      </button>
    </div>

    <!-- ì¶œì…ê¸°ë¡ -->
    <div id="entry" class="tab-content active">
      <h2>ì¶œì…ê¸°ë¡</h2>
      <div>
        <button
          class="sub-tab active"
          id="ownerBtn"
          onclick="showEntrySubTab('owner')"
        >
          ì„¸ëŒ€ì£¼
        </button>
        <button
          class="sub-tab"
          id="visitorBtn"
          onclick="showEntrySubTab('visitor')"
        >
          ë°©ë¬¸ì
        </button>
      </div>
      <div id="owner" class="sub-tab-content active">
        <h3>ì„¸ëŒ€ì£¼ ì¶œì…ê¸°ë¡</h3>
        <table>
          <thead>
            <tr>
              <th>ë‚ ì§œ/ì‹œê°„</th>
              <th>ë°©ë¬¸ ë™/í˜¸ìˆ˜</th>
              <th>ë°©ë¬¸ ëª©ì </th>
              <th>ì´ë¦„</th>
              <th>ì „í™”ë²ˆí˜¸</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2025-04-22 09:12</td>
              <td>101ë™ 303í˜¸</td>
              <td>ì •ê¸° ë°©ë¬¸</td>
              <td>í™ê¸¸ë™</td>
              <td>010-1234-5678</td>
            </tr>
            <tr>
              <td>2025-04-22 18:45</td>
              <td>101ë™ 303í˜¸</td>
              <td>ì •ê¸° ë°©ë¬¸</td>
              <td>í™ê¸¸ë™</td>
              <td>010-1234-5678</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="visitor" class="sub-tab-content">
        <h3>ë°©ë¬¸ì ì¶œì…ê¸°ë¡</h3>
        <table>
          <thead>
            <tr>
              <th>ë‚ ì§œ/ì‹œê°„</th>
              <th>ë°©ë¬¸ ë™/í˜¸ìˆ˜</th>
              <th>ë°©ë¬¸ ëª©ì </th>
              <th>ì´ë¦„</th>
              <th>ì „í™”ë²ˆí˜¸</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2025-04-22 14:02</td>
              <td>íƒë°°ê¸°ì‚¬</td>
              <td>íƒë°° ë°°ì†¡</td>
              <td>ê¹€íƒë°°</td>
              <td>010-2345-6789</td>
            </tr>
            <tr>
              <td>2025-04-22 14:10</td>
              <td>107ë™ 602í˜¸</td>
              <td>ìŒì‹ ë°°ë‹¬</td>
              <td>ì´ë°°ë‹¬</td>
              <td>010-3456-7890</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ë“±ë¡ ê´€ë¦¬ -->
    <div id="manage" class="tab-content">
      <h2>ë“±ë¡ ê´€ë¦¬</h2>
      <div class="sub-tabs">
        <button
          class="sub-tab active"
          id="registerBtn"
          onclick="showManageSubTab('register')"
        >
          ë“±ë¡
        </button>
        <button
          class="sub-tab"
          id="searchBtn"
          onclick="showManageSubTab('search')"
        >
          ê²€ìƒ‰
        </button>
      </div>

      <!-- ë“±ë¡ íƒ­ -->
      <div id="register" class="sub-tab-content active">
        <form class="register-form" onsubmit="handleRegister(event)">
          <label>ì–¼êµ´ ì‚¬ì§„</label>
          <input type="file" name="photo" accept="image/*" required /><br />
          <label>ì´ë¦„</label>
          <input type="text" name="name" required /><br />
          <label>ì£¼ì†Œ</label>
          <input type="text" name="address" required /><br />
          <label>ì „í™”ë²ˆí˜¸</label>
          <input type="tel" name="phone" required /><br />
          <button type="submit">ë“±ë¡</button>
        </form>

        <h3>ë“±ë¡ëœ ëª©ë¡</h3>
        <ul id="registerList"></ul>
      </div>

      <!-- ê²€ìƒ‰ íƒ­ -->
      <div id="search" class="sub-tab-content">
        <form class="search-form" onsubmit="handleSearch(event)">
          <input type="text" name="name" placeholder="ì´ë¦„" />
          <input type="text" name="unit" placeholder="ë™/í˜¸ìˆ˜" />
          <button type="submit">ê²€ìƒ‰</button>
        </form>
        <div id="search-results"></div>
      </div>
    </div>

    <!-- QRì½”ë“œ ë°œê¸‰ -->
    <div id="qr" class="tab-content">
      <button id="back-btn" onclick="showTab('manage')">â† ë©”ì¸ í˜ì´ì§€</button>
      <h1>ğŸ” ê´€ë¦¬ì í˜ì´ì§€ - QRì½”ë“œ ë°œê¸‰</h1>

      <section>
        <h2>â• QR ìƒì„±</h2>
        <form id="qr-form">
          <input type="text" id="phone" placeholder="ì „í™”ë²ˆí˜¸" required />
          <input
            type="number"
            id="duration"
            placeholder="ìœ íš¨ ì‹œê°„ (ë¶„)"
            required
          />
          <input type="text" id="memo" placeholder="ë©”ëª¨ (ì˜ˆ: ë°°ë‹¬ê¸°ì‚¬)" />
          <button type="submit">QR ìƒì„±</button>
        </form>
        <p id="qr-result"></p>
        <div id="qr-image"></div>
      </section>

      <section>
        <h2>ğŸ“‹ ì¸ì¦ ë¡œê·¸</h2>
        <table id="log-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>QR ì½”ë“œ</th>
              <th>ìƒíƒœ</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ë©”ëª¨</th>
              <th>ì‹œê°„</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="pagination">
          <button id="prev-page">ì´ì „</button>
          <span id="page-info">1í˜ì´ì§€</span>
          <button id="next-page">ë‹¤ìŒ</button>
        </div>
      </section>
    </div>

    <script>
      const ADMIN_PASSWORD = '1234' // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (ì›í•˜ì‹œëŠ” ê°’ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥)

      // ë“±ë¡ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      function loadRegisterList() {
        const list = JSON.parse(localStorage.getItem('registerList') || '[]')
        const ul = document.getElementById('registerList')
        ul.innerHTML = ''
        list.forEach((item, index) => {
          const li = document.createElement('li')
          li.innerHTML = `
        <strong>${item.name}</strong> - ${item.address} - ${item.phone}
        <button onclick="editEntry(${index})">ìˆ˜ì •</button>
        <button onclick="deleteEntry(${index})">ì‚­ì œ</button>
      `
          ul.appendChild(li)
        })
      }

      // ë“±ë¡ ì²˜ë¦¬
      function handleRegister(event) {
        event.preventDefault()
        const form = event.target
        const photo = form.photo.value // ì‹¤ì œ ì‚¬ì§„ ì €ì¥ì€ ìƒëµ (ë¡œì»¬Storage ë¯¸ì§€ì›)
        const name = form.name.value.trim()
        const address = form.address.value.trim()
        const phone = form.phone.value.trim()

        const entry = { name, address, phone }
        const list = JSON.parse(localStorage.getItem('registerList') || '[]')
        list.push(entry)
        localStorage.setItem('registerList', JSON.stringify(list))

        form.reset()
        loadRegisterList()
        alert('ë“±ë¡ ì™„ë£Œ')
      }

      // ê²€ìƒ‰ ì²˜ë¦¬
      function handleSearch(event) {
        event.preventDefault()
        const name = event.target.name.value.trim()
        const unit = event.target.unit.value.trim()
        const list = JSON.parse(localStorage.getItem('registerList') || '[]')

        const results = list
          .map((entry, index) => ({ ...entry, index }))
          .filter((entry) => {
            return (
              !name ||
              entry.name.includes(name) ||
              !unit ||
              entry.address.includes(unit)
            )
          })

        const resultDiv = document.getElementById('search-results')
        resultDiv.innerHTML = ''
        if (results.length === 0) {
          resultDiv.innerText = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'
        } else {
          const ul = document.createElement('ul')
          results.forEach((item) => {
            const li = document.createElement('li')
            li.innerHTML = `
          <strong>${item.name}</strong> - ${item.address} - ${item.phone}
          <button onclick="editEntry(${item.index})">ìˆ˜ì •</button>
          <button onclick="deleteEntry(${item.index})">ì‚­ì œ</button>
        `
            ul.appendChild(li)
          })
          resultDiv.appendChild(ul)
        }
      }

      // í•­ëª© ìˆ˜ì •
      function editEntry(index) {
        const pwd = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:')
        if (pwd !== ADMIN_PASSWORD) {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')
          return
        }

        const list = JSON.parse(localStorage.getItem('registerList') || '[]')
        const entry = list[index]
        const newName = prompt('ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', entry.name)
        const newAddress = prompt('ìƒˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”:', entry.address)
        const newPhone = prompt('ìƒˆ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', entry.phone)

        if (newName && newAddress && newPhone) {
          list[index] = {
            name: newName.trim(),
            address: newAddress.trim(),
            phone: newPhone.trim(),
          }
          localStorage.setItem('registerList', JSON.stringify(list))
          loadRegisterList()
          handleSearch(new Event('submit', { bubbles: true })) // ê²€ìƒ‰ ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
          alert('ìˆ˜ì • ì™„ë£Œ')
        } else {
          alert('ìˆ˜ì •ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')
        }
      }

      // í•­ëª© ì‚­ì œ
      function deleteEntry(index) {
        const pwd = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:')
        if (pwd !== ADMIN_PASSWORD) {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')
          return
        }

        const confirmed = confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')
        if (!confirmed) return

        const list = JSON.parse(localStorage.getItem('registerList') || '[]')
        list.splice(index, 1)
        localStorage.setItem('registerList', JSON.stringify(list))
        loadRegisterList()
        handleSearch(new Event('submit', { bubbles: true })) // ê²€ìƒ‰ ê²°ê³¼ ìƒˆë¡œê³ ì¹¨
        alert('ì‚­ì œ ì™„ë£Œ')
      }

      // í˜ì´ì§€ ë¡œë”© ì‹œ ë“±ë¡ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      document.addEventListener('DOMContentLoaded', () => {
        loadRegisterList()
      })
    </script>

    <script>
      // ë©”ì¸ íƒ­ í™œì„±í™” í•¨ìˆ˜
      function showTab(id) {
        // ëª¨ë“  íƒ­ê³¼ QR ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
        const tabs = document.querySelectorAll('.tab, #qrBtn')
        const contents = document.querySelectorAll('.tab-content')

        tabs.forEach((tab) => tab.classList.remove('active'))
        contents.forEach((content) => content.classList.remove('active'))

        // ì„ íƒëœ íƒ­ê³¼ ë‚´ìš©ì— active ì¶”ê°€
        if (id === 'entry') {
          document.getElementById('tab-entry').classList.add('active')
        } else if (id === 'manage') {
          document.getElementById('tab-manage').classList.add('active')
        } else if (id === 'qr') {
          document.getElementById('qrBtn').classList.add('active')
        }

        const selectedContent = document.getElementById(id)
        if (selectedContent) selectedContent.classList.add('active')

        // ì„œë¸Œ íƒ­ ì´ˆê¸°í™”
        if (id === 'entry') {
          showEntrySubTab('owner')
        } else if (id === 'manage') {
          showManageSubTab('register')
        }
      }

      // ì¶œì…ê¸°ë¡ ì„œë¸Œíƒ­ í™œì„±í™”
      function showEntrySubTab(subTabId) {
        const subTabs = ['owner', 'visitor']
        subTabs.forEach((id) => {
          const content = document.getElementById(id)
          const btn = document.getElementById(id + 'Btn')
          if (content && btn) {
            if (id === subTabId) {
              content.classList.add('active')
              btn.classList.add('active')
            } else {
              content.classList.remove('active')
              btn.classList.remove('active')
            }
          }
        })
      }

      // ë“±ë¡ê´€ë¦¬ ì„œë¸Œíƒ­ í™œì„±í™”
      function showManageSubTab(subTabId) {
        const subTabs = ['register', 'search']
        subTabs.forEach((id) => {
          const content = document.getElementById(id)
          const btn = document.getElementById(id + 'Btn')
          if (content && btn) {
            if (id === subTabId) {
              content.classList.add('active')
              btn.classList.add('active')
            } else {
              content.classList.remove('active')
              btn.classList.remove('active')
            }
          }
        })
      }

      // ì´ˆê¸° ì‹¤í–‰ ì‹œ ì¶œì…ê¸°ë¡ íƒ­ê³¼ ì„¸ëŒ€ì£¼ ì„œë¸Œíƒ­ í™œì„±í™”
      document.addEventListener('DOMContentLoaded', () => {
        showTab('entry')
      })

    </script>
  </body>
</html>
    <script>
      // ë©”ì¸ íƒ­ í™œì„±í™” í•¨ìˆ˜
      function showTab(id) {
        const tabs = document.querySelectorAll('.tab, #qrBtn');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach((tab) => tab.classList.remove('active'));
        contents.forEach((content) => content.classList.remove('active'));

        document.getElementById(id).classList.add('active');
        const activeTab = document.getElementById(`tab-${id}`) || document.getElementById(`${id}Btn`);
        if (activeTab) activeTab.classList.add('active');
      }

      // ì¶œì…ê¸°ë¡ ì„œë¸Œíƒ­
      function showEntrySubTab(id) {
        document.querySelectorAll('#entry .sub-tab').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('#entry .sub-tab-content').forEach(div => div.classList.remove('active'));
        document.getElementById(`${id}Btn`).classList.add('active');
        document.getElementById(id).classList.add('active');
      }

      // ë“±ë¡ê´€ë¦¬ ì„œë¸Œíƒ­
      function showManageSubTab(id) {
        document.querySelectorAll('#manage .sub-tab').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('#manage .sub-tab-content').forEach(div => div.classList.remove('active'));
        document.getElementById(`${id}Btn`).classList.add('active');
        document.getElementById(id).classList.add('active');
      }
    </script>

    <!-- QR ì½”ë“œ ê´€ë ¨ -->
    <script>
      let logData = [];
      let currentPage = 1;
      const rowsPerPage = 5;

      document.getElementById('qr-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const phone = document.getElementById('phone').value.trim();
        const duration = document.getElementById('duration').value;
        const memo = document.getElementById('memo').value.trim();

        if (!phone || !duration) {
          alert("í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        const data = `${phone}_${Date.now()}`;
        const qrcodeDiv = document.getElementById('qr-image');
        qrcodeDiv.innerHTML = "";
        const qr = new QRCode(qrcodeDiv, {
          text: data,
          width: 180,
          height: 180,
        });

        const resultText = document.getElementById('qr-result');
        resultText.textContent = `${duration}ë¶„ ë™ì•ˆ ìœ íš¨í•œ QRì½”ë“œ ìƒì„±ë¨`;

        // ë¡œê·¸ ì €ì¥
        const log = {
          id: logData.length + 1,
          code: data,
          status: "ë¯¸ì‚¬ìš©",
          phone,
          memo,
          time: new Date().toLocaleString()
        };
        logData.unshift(log);
        renderLogTable();
      });

      // ë¡œê·¸ í…Œì´ë¸” ë Œë”ë§
      function renderLogTable() {
        const tbody = document.querySelector('#log-table tbody');
        tbody.innerHTML = "";

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = logData.slice(start, end);

        pageData.forEach(log => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${log.id}</td>
            <td>${log.code}</td>
            <td>${log.status}</td>
            <td>${log.phone}</td>
            <td>${log.memo}</td>
            <td>${log.time}</td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById('page-info').textContent = `${currentPage}í˜ì´ì§€`;
      }

      document.getElementById('prev-page').addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderLogTable();
        }
      });

      document.getElementById('next-page').addEventListener('click', () => {
        const maxPage = Math.ceil(logData.length / rowsPerPage);
        if (currentPage < maxPage) {
          currentPage++;
          renderLogTable();
        }
      });
    </script>
  </body>
</html>
